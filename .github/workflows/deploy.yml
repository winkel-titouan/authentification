name: Build and Deploy to VPS
on:
 push:
 branches: [main]
jobs:
 build-and-deploy:
   runs-on: ubuntu-latest

   steps:
   - name: Checkout code
     uses: actions/checkout@v4
   - name: Setup Node.js
     uses: actions/setup-node@v4
     with:
       node-version: '18'
       cache: 'npm'

   - name: Install dependencies
     run: npm ci

   - name: Build project
     run: npm run build

   - name: Deploy to VPS via SCP
     uses: appleboy/scp-action@v0.1.3
     with:
       host: ${{ secrets.HOST }}
       username: ${{ secrets.USER }}
       key: ${{ secrets.SSH_PRIVATE_KEY }}
       port: 22<XXX>
       source: "dist/*"
       target: "/var/www/authentification/pb_public"
       strip_components: 1
       rm: true